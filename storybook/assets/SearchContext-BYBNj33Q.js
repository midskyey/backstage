import{j as p}from"./jsx-runtime-CvpxdxdE.js";import{l as R}from"./lodash-D8aMxhkM.js";import{r}from"./index-DSHF18-l.js";import{u as q}from"./useAsync-W0CErRou.js";import{s as T}from"./api-mJEpP5Oi.js";import{b as k,u as A}from"./ApiRef-DDVPwL0h.js";import{A as F,u as _}from"./useAnalytics-BqSe3k6a.js";import{a as M,c as O}from"./ConfigApi-1QFqvuIK.js";function b(e){var s=r.useRef();return r.useEffect(function(){s.current=e}),s.current}const d=k("search-context"),Z=()=>{const e=r.useContext(d);if(!e)throw new Error("useSearch must be used within a SearchContextProvider");const s=e.atVersion(1);if(!s)throw new Error("No SearchContext v1 found");return s},V=()=>r.useContext(d)!==void 0,E={term:"",types:[],filters:{},pageLimit:void 0,pageCursor:void 0},z=(e=E)=>{var C,S,P,y;const s=A(T),u=_(),[t,h]=r.useState(e.term),[i,l]=r.useState(e.types),[a,f]=r.useState(e.filters),[v,w]=r.useState(e.pageLimit),[m,c]=r.useState(e.pageCursor),x=b(t),g=b(a),o=q(async()=>{const n=await s.query({term:t,types:i,filters:a,pageLimit:v,pageCursor:m});return t&&u.captureEvent("search",t,{value:n.numberOfResults}),n},[t,i,a,v,m]),L=!o.loading&&!o.error&&((C=o.value)==null?void 0:C.nextPageCursor),j=!o.loading&&!o.error&&((S=o.value)==null?void 0:S.previousPageCursor),I=r.useCallback(()=>{var n;c((n=o.value)==null?void 0:n.nextPageCursor)},[(P=o.value)==null?void 0:P.nextPageCursor]),N=r.useCallback(()=>{var n;c((n=o.value)==null?void 0:n.previousPageCursor)},[(y=o.value)==null?void 0:y.previousPageCursor]);return r.useEffect(()=>{x!==void 0&&t!==x&&c(void 0)},[t,x,c]),r.useEffect(()=>{g!==void 0&&!R.isEqual(a,g)&&c(void 0)},[a,g,c]),{result:o,term:t,setTerm:h,types:i,setTypes:l,filters:a,setFilters:f,pageLimit:v,setPageLimit:w,pageCursor:m,setPageCursor:c,fetchNextPage:L?I:void 0,fetchPreviousPage:j?N:void 0}},B=e=>{const{initialState:s,children:u}=e,t=z(s);return p.jsx(F,{attributes:{searchTypes:t.types.sort().join(",")},children:p.jsx(d.Provider,{value:M({1:t}),children:u})})},D=e=>{const{initialState:s,inheritParentContextIfAvailable:u,children:t}=e,h=V(),i=A(O),l=s??{},a=i.has("search.query.pageLimit")?{pageLimit:i.getNumber("search.query.pageLimit")}:{},f={...E,...l,...a};return h&&u?p.jsx(p.Fragment,{children:t}):p.jsx(B,{initialState:f,children:t})};D.__docgenInfo={description:`@public
Search context provider which gives you access to shared state between search components`,methods:[],displayName:"SearchContextProvider"};export{D as S,b as a,Z as u};
