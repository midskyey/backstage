import{l as q}from"./lodash-D2SO6J9k.js";import{r,R as l}from"./index-CV65Cz2T.js";import{u as T}from"./useAsync-cwiHyrW_.js";import{s as k}from"./api-DaAaT8k3.js";import{b as F,u as b}from"./ApiRef-DSSgzaW4.js";import{A as _,u as j}from"./useAnalytics-BvU8z2Qw.js";import{a as M,c as O}from"./ConfigApi-BmcvyZGI.js";function E(e){var s=r.useRef();return r.useEffect(function(){s.current=e}),s.current}const x=F("search-context"),Y=()=>{const e=r.useContext(x);if(!e)throw new Error("useSearch must be used within a SearchContextProvider");const s=e.atVersion(1);if(!s)throw new Error("No SearchContext v1 found");return s},V=()=>r.useContext(x)!==void 0,A={term:"",types:[],filters:{},pageLimit:void 0,pageCursor:void 0},z=(e=A)=>{var C,S,P,y;const s=b(k),u=j(),[t,p]=r.useState(e.term),[i,h]=r.useState(e.types),[a,v]=r.useState(e.filters),[f,w]=r.useState(e.pageLimit),[m,c]=r.useState(e.pageCursor),g=E(t),d=E(a),o=T(async()=>{const n=await s.query({term:t,types:i,filters:a,pageLimit:f,pageCursor:m});return t&&u.captureEvent("search",t,{value:n.numberOfResults}),n},[t,i,a,f,m]),L=!o.loading&&!o.error&&((C=o.value)==null?void 0:C.nextPageCursor),I=!o.loading&&!o.error&&((S=o.value)==null?void 0:S.previousPageCursor),N=r.useCallback(()=>{var n;c((n=o.value)==null?void 0:n.nextPageCursor)},[(P=o.value)==null?void 0:P.nextPageCursor]),R=r.useCallback(()=>{var n;c((n=o.value)==null?void 0:n.previousPageCursor)},[(y=o.value)==null?void 0:y.previousPageCursor]);return r.useEffect(()=>{g!==void 0&&t!==g&&c(void 0)},[t,g,c]),r.useEffect(()=>{d!==void 0&&!q.isEqual(a,d)&&c(void 0)},[a,d,c]),{result:o,term:t,setTerm:p,types:i,setTypes:h,filters:a,setFilters:v,pageLimit:f,setPageLimit:w,pageCursor:m,setPageCursor:c,fetchNextPage:L?N:void 0,fetchPreviousPage:I?R:void 0}},B=e=>{const{initialState:s,children:u}=e,t=z(s);return l.createElement(_,{attributes:{searchTypes:t.types.sort().join(",")}},l.createElement(x.Provider,{value:M({1:t})},u))},D=e=>{const{initialState:s,inheritParentContextIfAvailable:u,children:t}=e,p=V(),i=b(O),h=s??{},a=i.has("search.query.pageLimit")?{pageLimit:i.getNumber("search.query.pageLimit")}:{},v={...A,...h,...a};return p&&u?l.createElement(l.Fragment,null,t):l.createElement(B,{initialState:v},t)};D.__docgenInfo={description:`@public
Search context provider which gives you access to shared state between search components`,methods:[],displayName:"SearchContextProvider"};export{D as S,E as a,Y as u};
