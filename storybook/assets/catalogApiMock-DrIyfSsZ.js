var S=n=>{throw TypeError(n)};var g=(n,t,e)=>t.has(n)||S("Cannot "+e);var c=(n,t,e)=>(g(n,t,"read from private field"),e?e.call(n):t.get(n)),w=(n,t,e)=>t.has(n)?S("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(n):t.set(n,e),R=(n,t,e,o)=>(g(n,t,"write to private field"),o?o.call(n,e):t.set(n,e),e),u=(n,t,e)=>(g(n,t,"access private method"),e);import{N as b,f as y}from"./ApiRef-DDVPwL0h.js";import{s as j,p as B,D as M}from"./ref-8pKZtiZi.js";import{c as v}from"./api-Co_hnf76.js";import{b as C}from"./appWrappers-2OGH7oXz.js";const U=Symbol.for("CATALOG_FILTER_EXISTS_0e15b590c0b343a2bae3e787e84c2111"),F=["attachments","relations","status","metadata.name","metadata.namespace","metadata.uid","metadata.etag"];function T(n){const t=[];function e(o,a){if(!F.includes(o)){if(a==null||["string","number","boolean"].includes(typeof a)){t.push({key:o,value:a});return}if(typeof a=="object"){if(Array.isArray(a)){for(const i of a)if(e(o,i),typeof i=="string"){const s=`${o}.${i}`;t.some(f=>f.key.toLocaleLowerCase("en-US")===s.toLocaleLowerCase("en-US"))||t.push({key:s,value:!0})}return}for(const[i,s]of Object.entries(a))e(o?`${o}.${i}`:i,s)}}}return e("",n),t}function I(n){var e,o,a;const t=T(n);(e=n.metadata)!=null&&e.name&&t.push({key:"metadata.name",value:n.metadata.name.toLocaleLowerCase("en-US")}),(o=n.metadata)!=null&&o.namespace&&t.push({key:"metadata.namespace",value:n.metadata.namespace.toLocaleLowerCase("en-US")}),(a=n.metadata)!=null&&a.uid&&t.push({key:"metadata.uid",value:n.metadata.uid.toLocaleLowerCase("en-US")}),n.metadata.namespace||t.push({key:"metadata.namespace",value:M});for(const i of n.relations??[])t.push({key:`relations.${i.type.toLocaleLowerCase("en-US")}`,value:i.targetRef.toLocaleLowerCase("en-US")});return t}function p(n){if(!n)return()=>!0;const t=[n].flat();return e=>{const o=I(e);return t.some(a=>{for(const[i,s]of Object.entries(a)){const f=o.filter(m=>m.key===i.toLocaleLowerCase("en-US")).map(m=>{var l;return(l=m.value)==null?void 0:l.toString().toLocaleLowerCase("en-US")});if(f.length===0)return!1;if(s!==U&&!(f!=null&&f.includes(String(s).toLocaleLowerCase("en-US"))))return!1}return!0})}}var r,d,E;class _{constructor(t){w(this,d);w(this,r);var e;R(this,r,((e=t==null?void 0:t.entities)==null?void 0:e.slice())??[])}async getEntities(t){const e=p(t==null?void 0:t.filter);return{items:c(this,r).filter(e)}}async getEntitiesByRefs(t){const e=p(t.filter),o=u(this,d,E).call(this);return{items:t.entityRefs.map(a=>o.get(a)).map(a=>a&&e(a)?a:void 0)}}async queryEntities(t){if(t&&"cursor"in t)return{items:[],pageInfo:{},totalItems:0};const e=p(t==null?void 0:t.filter),o=c(this,r).filter(e);return{items:o,pageInfo:{},totalItems:o.length}}async getEntityAncestors(t){const e=u(this,d,E).call(this).get(t.entityRef);if(!e)throw new b(`Entity with ref ${t.entityRef} not found`);return{items:[{entity:e,parentEntityRefs:[]}],rootEntityRef:t.entityRef}}async getEntityByRef(t){return u(this,d,E).call(this).get(j(B(t)))}async removeEntityByUid(t){const e=c(this,r).findIndex(o=>o.metadata.uid===t);e!==-1&&c(this,r).splice(e,1)}async refreshEntity(t){}async getEntityFacets(t){const e=p(t.filter),o=c(this,r).filter(e);return{facets:Object.fromEntries(t.facets.map(i=>{var m;const s=new Map;for(const l of o){const L=(m=I(l).find(A=>A.key===i.toLocaleLowerCase("en-US")))==null?void 0:m.value;L&&s.set(String(L),(s.get(String(L))??0)+1)}const f=Array.from(s.entries()).map(([l,h])=>({value:l,count:h}));return[i,f]}))}}async getLocations(t){throw new y("Method not implemented.")}async getLocationById(t){throw new y("Method not implemented.")}async getLocationByRef(t){throw new y("Method not implemented.")}async addLocation(t){throw new y("Method not implemented.")}async removeLocationById(t){throw new y("Method not implemented.")}async getLocationByEntity(t){throw new y("Method not implemented.")}async validateEntity(t,e){throw new y("Method not implemented.")}}r=new WeakMap,d=new WeakSet,E=function(){return new Map(c(this,r).map(t=>[j(t),t]))};function O(n,t){return e=>{const o=t();if(e)for(const[a,i]of Object.entries(e))typeof i=="function"?o[a].mockImplementation(i):o[a]=i;return Object.assign(o,{factory:C({api:n,deps:{},factory:()=>o})})}}function k(n){return new _(n)}(n=>{n.factory=t=>C({api:v,deps:{},factory:()=>new _(t)}),n.mock=O(v,()=>({getEntities:jest.fn(),getEntitiesByRefs:jest.fn(),queryEntities:jest.fn(),getEntityAncestors:jest.fn(),getEntityByRef:jest.fn(),removeEntityByUid:jest.fn(),refreshEntity:jest.fn(),getEntityFacets:jest.fn(),getLocations:jest.fn(),getLocationById:jest.fn(),getLocationByRef:jest.fn(),addLocation:jest.fn(),removeLocationById:jest.fn(),getLocationByEntity:jest.fn(),validateEntity:jest.fn()}))})(k||(k={}));export{k as c};
